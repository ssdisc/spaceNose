# 星际嗅探者 (Interstellar Sniffer) - 全栈物联网数据监控平台

[![Status](https://img.shields.io/badge/status-active-success.svg)]()
[![Platform](https://img.shields.io/badge/platform-STM32%20%7C%20Python%20%7C%20Vue.js-blue.svg)]()

**星际嗅探者** 是一个完整的物联网（IoT）数据采集、传输、处理和实时可视化监控系统。该项目旨在实现从底层传感器（STM32）到云端服务器（Python FastAPI），再到用户界面（Vue.js）的端到端数据链路，为气体探测任务提供一个高实时性、高可靠性的监控解决方案。

---

## 🚀 系统架构

本系统采用五层架构设计，确保了各层职责清晰，易于维护和扩展。

```
[ 硬件传感器层 ] --- (UART) ---> [ 无线通信层 ] --- (WiFi/UDP) ---> [ 后端服务层 ] --- (WebSocket) ---> [ 前端展示层 ]
|                |              |              |                |                  |                |
|  STM32F407     |              |  ESP8266     |                |  FastAPI (Python)  |                |  Vue.js + Canvas
|  (数据采集)     |              |  (数据转发)   |                |  (UDP/WebSocket)   |                |  (实时可视化)
```

1.  **硬件传感器层 (STM32)**: 使用 `STM32F407ZGT6` 微控制器采集模拟传感器数据，将其处理并封装成JSON格式。
2.  **无线通信层 (ESP8266)**: STM32通过 `UART` 串口将JSON数据发送给 `ESP8266` WiFi模块。
3.  **网络中继层 (电脑WiFi热点)**: ESP8266作为UDP客户端，连接到电脑创建的WiFi热点，并将数据包发送到指定IP和端口。
4.  **后端服务层 (FastAPI)**: 运行在电脑上的 `FastAPI` 服务器。
    *   **UDP服务器** 监听指定端口，接收来自ESP8266的数据。
    *   **WebSocket服务器** 将处理后的数据（加入时间戳）实时广播给所有连接的前端客户端。
    *   **HTTP服务器** 提供前端Vue应用的静态文件访问。
5.  **前端展示层 (Vue.js)**: 浏览器中的Web应用。
    *   通过 `WebSocket` 实时接收后端推送的数据。
    *   使用 `Canvas` 绘制实时数据曲线图，并以卡片和日志形式展示数据。

详细图解请参考: [`系统架构图.txt`](系统架构图.txt)

## ✨ 核心功能

### 嵌入式端 (STM32)
- **实时采集**: 每秒采集一次ADC数据并转换为电压值。
- **数据封装**: 将数据打包成 `{"counter":N, "adc":X, "voltage":Y}` JSON格式。
- **稳定通信**: 增强的ESP8266驱动，支持UDP连接、普通/透传模式数据发送，并包含完整的状态反馈和错误处理。
- **配置灵活**: WiFi热点、服务器IP和端口等关键参数可在代码中轻松配置。

### 后端服务器 (FastAPI)
- **异步架构**: 基于 `asyncio` 实现异步非阻塞的UDP和WebSocket服务，性能卓越。
- **多协议支持**: 同时处理UDP数据接收、WebSocket实时广播和HTTP静态服务。
- **数据处理**: 接收数据后自动解析、验证并添加服务器时间戳。
- **多客户端管理**: 支持多个前端客户端同时连接和接收数据广播。

### 前端应用 (Vue.js)
- **实时可视化**: 使用原生Canvas手绘实时曲线图，动态展示数据趋势，自动缩放坐标轴。
- **丰富的数据展示**: 通过数据卡片、滚动日志等多种形式展示最新和历史数据。
- **健壮的连接**: WebSocket客户端支持连接状态实时指示和断线自动重连。
- **现代UI设计**: 采用响应式设计，适配不同屏幕，提供渐变背景、卡片动画等良好视觉效果。

详细功能列表请参考: [`项目实现总结.md`](项目实现总结.md)

## 🛠️ 技术栈

| 层次       | 技术/组件         | 描述                               |
| :--------- | :---------------- | :--------------------------------- |
| **嵌入式层** | `C`, `STM32 HAL`  | 使用PlatformIO进行开发的STM32固件     |
| **通信层**   | `ESP8266`         | UART, UDP, WiFi, JSON              |
| **后端层**   | `Python`, `FastAPI` | Uvicorn, asyncio, websockets       |
| **前端层**   | `Vue.js 2`, `Canvas` | JavaScript (ES6+), CSS3            |
| **开发工具** | `PlatformIO`, `VSCode` | 跨平台嵌入式开发环境               |

## ⚡ 5分钟快速上手指南

按照以下步骤，即可在5分钟内启动并运行整个系统。

### 1️⃣ 硬件准备与连接
- 将 `ESP8266` 模块正确连接到 `STM32F407` 开发板。
  ```
  STM32 PA2 (TX) → ESP8266 RX
  STM32 PA3 (RX) ← ESP8266 TX
  STM32 GND      → ESP8266 GND
  3.3V           → ESP8266 VCC & CH_PD (必须！)
  ```
- 将 `ST-Link` 连接到电脑和开发板。

### 2️⃣ 配置电脑WiFi热点
- **Windows**: `设置` → `网络和Internet` → `移动热点`。
- **重要**: 频段必须设置为 **2.4 GHz**，因为ESP8266不支持5GHz。
- 记下你的热点名称和密码。

### 3️⃣ 修改STM32配置
- 打开 `src/main.c` 文件。
- 修改WiFi热点和服务器IP信息。你的服务器IP就是你电脑在热点中的IP地址，通常是 `192.168.137.1`。
  ```c
  // src/main.c
  const char* wifi_ssid = "你的热点名称";
  const char* wifi_password = "你的热点密码";
  const char* server_ip = "192.168.137.1"; // 通常是这个，如有不同请修改
  ```

### 4️⃣ 启动后端服务器
- **双击运行根目录下的 `start_server.bat` 脚本**。
- 该脚本会自动安装Python依赖并启动FastAPI服务器。
- 看到 `Uvicorn running on http://0.0.0.0:8000` 表示启动成功。

### 5️⃣ 编译和上传固件
- 在VSCode中，使用PlatformIO插件。
- 点击底部状态栏的 `→` (Upload) 按钮来编译和烧录程序到STM32。

### 6️⃣ 查看结果
- 程序上传成功后，STM32会自动重启并连接网络。
- 打开浏览器，访问 **`http://localhost:8000`**。
- 如果一切正常，你将看到实时更新的数据卡片、图表和日志！🚀

## 📁 项目文件结构
```
spaceNose/
├── src/                          # STM32源代码
│   ├── main.c                    # 主程序（采集+发送）
│   └── esp8266_driver.c/h        # ESP8266驱动
├── backend/                      # 后端服务器
│   ├── main.py                   # FastAPI服务器（UDP+WebSocket）
│   └── requirements.txt          # Python依赖
├── web/                          # 前端Vue应用
│   └── src/App.vue               # Vue主组件
├── 系统架构图.txt                # 📐 详细系统架构图
├── 项目实现总结.md               # 🎉 已完成功能和技术亮点
├── start_server.bat              # 启动脚本
└── README.md                     # 📍 你正在阅读的文件
```

## 📚 文档索引
- **[系统架构图.txt](系统架构图.txt)**: 深入了解系统各层设计和数据流。
- **[项目实现总结.md](项目实现总结.md)**: 查看已实现功能的详细列表和技术亮点。
- **[docs/](docs/)**: 包含项目立项申请书等更多详细文档。

## 📞 联系方式
- **负责人**: 苏世鼎
- **项目组**: 星际嗅探者团队
