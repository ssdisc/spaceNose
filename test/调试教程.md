## VSCode调试实战演练

### 场景：调试甲烷检测阈值

**问题**：我们想确认甲烷浓度超过10ppm时，系统能正确报警。

### 步骤1：设置断点

在 `sensor_simulator.c` 的第130行（AI_Classify函数）设置断点：

```c
130 | GasType_t AI_Classify(SensorData_t *data)
131 | {
132 |     // 阈值判断（简化版AI）
133 |●    if(data->ch4_ppm > 10.0) {  // ← 点击这里设置断点
134 |         return GAS_CH4;
135 |     }
```

### 步骤2：启动调试

1. 按 `F5` 启动调试
2. 程序会运行到断点处暂停

### 步骤3：查看变量

在暂停时：
- 鼠标悬停在 `data->ch4_ppm` 上查看值
- 在"监视"面板添加：`data->ch4_ppm > 10.0`

### 步骤4：条件断点

如果只想在甲烷>50ppm时才暂停：

1. 右键断点 → "编辑断点"
2. 输入条件：`data->ch4_ppm > 50.0`
3. 按回车

### 步骤5：修改代码并重新测试

假设你发现阈值10ppm太低，改成20ppm：

```c
if(data->ch4_ppm > 20.0) {  // 修改阈值
    return GAS_CH4;
}
```

保存后，按 `Ctrl+Shift+F5` 重启调试。

### 步骤6：日志输出调试

添加printf调试信息：

```c
GasType_t AI_Classify(SensorData_t *data)
{
    printf("[DEBUG] CH4=%.2f, 阈值=10.0\n", data->ch4_ppm);

    if(data->ch4_ppm > 10.0) {
        printf("[DEBUG] 检测到甲烷！\n");
        return GAS_CH4;
    }
    // ...
}
```

---

## 调试技巧总结

### ✅ 推荐做法
- 经常使用断点，观察程序运行流程
- 用"监视"功能跟踪关键变量
- 用条件断点过滤无关情况
- 先在模拟器上验证算法，再移植到STM32

### ❌ 避免做法
- 不要盲目修改代码
- 不要忘记保存文件
- 不要在调试时修改关键变量（除非明确知道后果）

---

## 下一步

✅ 现在你可以：
1. 修改传感器阈值
2. 添加新的气体类型
3. 改进滤波算法
4. 实现数据存储逻辑

等有了真实传感器后，直接把 `Sensor_ReadAll()` 改成读取真实ADC即可！
